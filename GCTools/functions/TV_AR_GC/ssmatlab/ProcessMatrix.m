function mat=ProcessMatrix(mat,log_op,norm_op)%PROCESSMATRIX Pre-processing columns of a given matrix. %%   MAT=PROCESSSMATRIX(MAT,LOG_OP,NORM_OP)%   Pre-process columns of matrix MAT for later use.%   Pre-processing can include: %       logarithmization %       normalization%                           %   INPUTS:%        MAT - a matrix (whose columns we want to process).%%   Optional inputs:%       LOG_OP - defines option for logarithmization:%           if LOG_OP=1 -> take log of data %                          (Not done, by default)%       NORM_OP - defines option for normalization:%           if NORM_OP=1 -> normalize data (i.e. subtract mean and divide %                                           by standard deviation)%                                           (Done, by default)                   %   OUTPUT:%       MAT - processed matrix.%   Written by L. Aguiar-Conraria and M.J. Soares%%   Luís AGUIAR-CONRARIA              Maria Joana SOARES                      %   Dep. Economics                    Dep. Mathematics and Applications   %   University of Minho               University of Minho%   4710-057 Braga                    4710-057 Braga%   PORTUGAL                          PORTUGAL%                           %   lfaguiar@eeg.uminho.pt            jsoares@math.uminho.pt %%%%%%%%%%%%%%%%%%%%    Default values       %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%if ( nargin<2 || isempty(log_op) )    log_op=0;  % By default, we do not take log of seriesendif ( nargin<3|| isempty(norm_op) )    norm_op=1; % By default, we normalizeend%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%mat(any(isnan(mat)'),:) = []; % To delete empty spacessmat=size(mat);if  smat(1)==1   % Just one row series    	mat=mat(:);  % Make it a columnendnRows=size(mat,1);if log_op==1 % Take log of data    if ~(all(mat(:)>0))        error('Matrix has negative or zero elements; can not take log')    else	   mat=log(mat);     endendif norm_op==1 % Normalize data	    mean_cols=mean(mat);    mat=mat-repmat(mean_cols,nRows,1);    std_cols=std(mat);    if ~(all(std_cols>0))        error('Standard deviation is zero; can not normalize')    else    mat=mat./repmat(std_cols,nRows,1);    end endif smat(1)==1    mat=mat(:).';end%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%end